#! /bin/bash

CURRENT=""
while true; do
    # Set your musicdb
    MDB="/home/godo/music/"

    # current dir
    MDIR="`mpc -f %file% | head -1 | sed 's:[^/]*$::'`"

    # Search for common album art filenames (folder. , back., front.,)
    COVRET=$( ls "$MDB$MDIR" | egrep "\.jpg|\.png|\.gif" )

    ALBUMART="$(echo $MDB$MDIR$COVRET)"

    if [ "$ALBUMART" != "$CURRENT" ]; then
        # remove old album art
        pkill -f "sxiv -N mpd_album_art"

        # display album art
        # sxiv -N "mpd_album_art" -b -s f -g 256x256-100-100 "$MDB$MDIR$COVRET" &
        sxiv -N "mpd_album_art" -b -s f -g 256x256-100-100 "$ALBUMART" &
        # timeout -sHUP 5 sxiv -N "mpd_album_art" -b -s f -g 256x256-100-100 "$MDB$MDIR$COVRET" 2> /dev/null & 
        CURRENT=$ALBUMART
    fi


    # exit

    echo sleeping
    sleep 5
done
