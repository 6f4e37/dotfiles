#!/usr/bin/env bash

# -----------------------------------------------------------------------------
# volume
# Description: Bezel UI module to change volume with feedback audio blip
# -----------------------------------------------------------------------------
# Requires:
#   paplay
# -----------------------------------------------------------------------------
# Useage:      $ ./volume
# -----------------------------------------------------------------------------

# Source display_bezel which provides display_bezel() taking $1:module_name and $2:content
source "$HOME/.bin/ui/bezel/display_bezel"

function play_audio() {
    # audio played on volume change
    local audio="$1"

    # play volume change blip
    if [[ -e "${audio}" ]]; then
        paplay "${audio}"
    fi
}

function main() {
    # name of the bezel module
    local module_name='bezel_volume'

    # change percentage
    local level_percent='5'

    # audio played on volume change
    local blip='/usr/share/sounds/freedesktop/stereo/audio-volume-change.oga'

    case $1 in
        toggle)
            amixer -q set Master toggle
            ;;
        down)
            amixer -q set Master "${level_percent}"%- unmute
            # play blip
            play_audio "${blip}"
            # display bezel with new level
            display_bezel "${module_name}" "$(amixer get Master | sed -n 's/^.*\[\([0-9]\+\)%.*$/\1/p' | uniq)"
            ;;
        up)
            amixer -q set Master "${level_percent}"%+ unmute
            # play blip
            play_audio "${blip}"
            # display bezel with new level
            display_bezel "${module_name}" "$(amixer get Master | sed -n 's/^.*\[\([0-9]\+\)%.*$/\1/p' | uniq)"
            ;;
        min)
            amixer -q set Master 0% unmute
            # play blip
            play_audio "${blip}"
            # display bezel with new level
            display_bezel "${module_name}" "$(amixer get Master | sed -n 's/^.*\[\([0-9]\+\)%.*$/\1/p' | uniq)"
            ;;
        max)
            amixer -q set Master 100% unmute
            # play blip
            play_audio "${blip}"
            # display bezel with new level
            display_bezel "${module_name}" "$(amixer get Master | sed -n 's/^.*\[\([0-9]\+\)%.*$/\1/p' | uniq)"
            ;;
        *)
            exit 2
            ;;
    esac
}

# main
main "$@"
