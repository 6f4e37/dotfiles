#!/usr/bin/env bash

# declare array for storing bezel properties
declare -A bezel
# bezel name
bezel['name']=''
# stream to read from
bezel['stream']=''
# default monitor
bezel['monitor']=''
# bezel x location
bezel['x']=''
# bezel y location
bezel['y']=''
# bezel width
bezel['width']=''
# bezel height
bezel['height']=''
# font used to display stream
bezel['font']=''
# default foreground color
bezel['color_fg']=''
# default background color
bezel['color_bg']=''

function set_bezel_name() {
    bezel['name']="$1"
}
function get_bezel_name() {
    echo "${bezel['name']}"
}

function set_bezel_stream() {
    bezel['stream']="$1"
}
function get_bezel_stream() {
    echo "${bezel['stream']}"
}

function set_bezel_monitor() {
    bezel['monitor']="$1"
}
function get_bezel_monitor() {
    echo "${bezel['monitor']}"
}

function set_bezel_x() {
    bezel['x']="$1"
}
function get_bezel_x() {
    echo "${bezel['x']}"
}

function set_bezel_y() {
    bezel['y']="$1"
}
function get_bezel_y() {
    echo "${bezel['y']}"
}

function set_bezel_width() {
    bezel['width']="$1"
}
function get_bezel_width() {
    echo "${bezel['width']}"
}

function set_bezel_height() {
    bezel['height']="$1"
}
function get_bezel_height() {
    echo "${bezel['height']}"
}

function set_bezel_font() {
    bezel['font']="$1"
}
function get_bezel_font() {
    echo "${bezel['font']}"
}

function set_bezel_color_fg() {
    bezel['color_fg']="$1"
}
function get_bezel_color_fg() {
    echo "${bezel['color_fg']}"
}

function set_bezel_color_bg() {
    bezel['color_bg']="$1"
}
function get_bezel_color_bg() {
    echo "${bezel['color_bg']}"
}

function draw_bezel() {
    # define arguments passed to dzen
    local dzen_args=( '-title-name' "bezel_$(get_bezel_name)" )
    dzen_args+=( '-x' "$(get_bezel_x)" '-y' "$(get_bezel_y)" '-w' "$(get_bezel_width)" '-h' "$(get_bezel_height)" )
    dzen_args+=( '-ta' 'c' '-fg' "$(get_bezel_color_fg)" '-bg' "$(get_bezel_color_bg)" )
    dzen_args+=( '-e' 'onstart=raise' '-xs' "$(get_bezel_monitor)" )

    # make the bezel
    tail -f "$(get_bezel_stream)" > >(dzen2 "${dzen_args[@]}") &
    # (dzen2 "${dzen_args[@]}" < "$(get_bezel_stream)"; rm -f "$(get_bezel_stream)") &

    # pipe to fifo
    # (echo "$(get_bezel_formatted)"; sleep 1) >> "$(get_bezel_stream)"
}

function pipe_content_to_stream() {
    # pipe to stream
    (echo "$(get_bezel_formatted)"; sleep 1) >> "$(get_bezel_stream)"
}
