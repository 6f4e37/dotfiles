#!/usr/bin/env bash

# -----------------------------------------------------------------------------
# backlight
# Description: Bezel UI module to change keyboard light level
# -----------------------------------------------------------------------------
# Requires:
#   kbdlight
# -----------------------------------------------------------------------------
# Useage:      $ ./keys
# -----------------------------------------------------------------------------

# Source display_bezel which provides display_bezel() taking $1:module_name and $2:content
source "$HOME/.bin/ui/bezel/display_bezel"

# kbdlight reports on 256 point scale (0 - 255) but gdbar takes on 100
#   point scale
function scale_kbdlight() {
    local native="$(kbdlight get)"
    local scaled="$(( ${native} * 100 / 255 ))"

    echo "${scaled}"
}

function main() {
    # name of the bezel module
    local module_name='bezel_keys'

    # change percentage
    local level_percent='20'

    case $1 in
        down)
            kbdlight down "${level_percent}"
            # display bezel with new level
            display_bezel "${module_name}" "$(scale_kbdlight)"
            ;;
        up)
            kbdlight up "${level_percent}"
            # display bezel with new level
            display_bezel "${module_name}" "$(scale_kbdlight)"
            ;;
        min)
            kbdlight off
            # display bezel with new level
            display_bezel "${module_name}" "$(scale_kbdlight)"
            ;;
        max)
            kbdlight max
            # display bezel with new level
            display_bezel "${module_name}" "$(scale_kbdlight)"
            ;;
        *)
            exit 2
            ;;
    esac
}

# main
main "$@"
